#!/bin/bash

if [ "$MASTER" -eq 1 ]; then
  /usr/local/bin/arkmanager checkupdate

  updateNeeded=$?

  [[ "$updateNeeded" -eq 0 ]] && exit 0

  /usr/local/bin/arkmanager update --warn --backup
  exit 0;
fi

currentVersion=$(xargs < /ark/server/install/version.txt)
runningVersion=$(arkmanager status | grep "Server version" | grep "$currentVersion" )

[[ "$runningVersion" == "$currentVersion" ]] && exit 0

/usr/local/bin/arkmanager restart --backup --warn --warnreason="Server update" --noautoupdate --alwaysrestart
