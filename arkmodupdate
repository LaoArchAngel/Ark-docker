#!/usr/bin/env bash

mapfile -t instances < <( /usr/local/bin/arkmanager list-instances --brief )
needUpdate=()

for inst in "${instances[@]}"; do
  /usr/local/bin/arkmanager checkmodupdate --revstatus "@$inst"
  updateNeeded=$?
  [[ "$updateNeeded" -ne 0 ]] && needUpdate+=( "@$inst" )
done

for upd in "${needUpdate[@]}" ; do
  /usr/local/bin/arkmanager stop --warn "Mod update" "$upd"
  /usr/local/bin/arkmanager update --update-mods --backup "$upd"
  /usr/local/bin/arkmanager start "$upd"
done
